import{K as Et,L as Rt,M as qt,S as et,i as rt,s as ot,F as Lt,e as R,k as Z,c as q,a as L,d as P,m as H,b as E,f as Bt,g as F,N as Ct,G as Nt,H as Tt,I as Dt,q as it,o as st,r as At,v as gt,O as mt,P as $,E as z,Q as Ft,t as U,h as G,J as I,j as nt,R as S,w as _t,x as wt,y as bt,B as jt,T as Ot}from"../chunks/index-c5ee12bd.js";import{r as Kt}from"../chunks/index-f7dfcf04.js";const Zt=["focus","blur","fullscreenchange","fullscreenerror","scroll","cut","copy","paste","keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel","drag","dragend","dragenter","dragstart","dragleave","dragover","drop","touchcancel","touchend","touchmove","touchstart","pointerover","pointerenter","pointerdown","pointermove","pointerup","pointercancel","pointerout","pointerleave","gotpointercapture","lostpointercapture"];function Ht(){const t=Et();return e=>{const r=Zt.map(o=>Rt(e,o,n=>qt(t,n)));return{destroy:()=>r.forEach(o=>o())}}}class Ut{constructor(){this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.redraw=this.redraw.bind(this),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.currentLayerId=0,this.setups=new Map,this.renderers=new Map,this.needsSetup=!1,this.needsResize=!0,this.needsRedraw=!0,this.layerSequence=[]}redraw(){this.needsRedraw=!0}resize(){this.needsResize=!0,this.needsRedraw=!0}register({setup:e,render:r}){return e&&(this.setups.set(this.currentLayerId,e),this.needsSetup=!0),this.renderers.set(this.currentLayerId,r),this.needsRedraw=!0,this.currentLayerId++}unregister(e){this.renderers.delete(e),this.needsRedraw=!0}render({autoclear:e,pixelRatio:r,context:o,width:n,height:a}){const i={context:o,width:n,height:a};if(this.needsResize&&(o.setTransform(r,0,0,r,0,0),this.needsResize=!1),this.needsSetup){for(const[l,h]of this.setups)h(i),this.setups.delete(l);this.needsSetup=!1}if(this.needsRedraw){e&&o.clearRect(0,0,n,a);for(const l of this.layerSequence)this.renderers.get(l)(i);this.needsRedraw=!1}}}function Gt(t){let e,r,o,n,a,i,l,h,d;const s=t[13].default,u=Lt(s,t,t[12],null);return{c(){e=R("canvas"),a=Z(),i=R("div"),u&&u.c(),this.h()},l(c){e=q(c,"CANVAS",{style:!0,width:!0,height:!0}),L(e).forEach(P),a=H(c),i=q(c,"DIV",{style:!0});var p=L(i);u&&u.l(p),p.forEach(P),this.h()},h(){E(e,"style",r="display: block; width: "+t[1]+"px; height: "+t[2]+"px;"+(t[3]?` ${t[3]}`:"")),E(e,"width",o=t[1]*t[0]),E(e,"height",n=t[2]*t[0]),Bt(i,"display","none")},m(c,p){F(c,e,p),t[14](e),F(c,a,p),F(c,i,p),u&&u.m(i,null),t[15](i),l=!0,h||(d=Ct(t[6].call(null,e)),h=!0)},p(c,[p]){(!l||p&14&&r!==(r="display: block; width: "+c[1]+"px; height: "+c[2]+"px;"+(c[3]?` ${c[3]}`:"")))&&E(e,"style",r),(!l||p&3&&o!==(o=c[1]*c[0]))&&E(e,"width",o),(!l||p&5&&n!==(n=c[2]*c[0]))&&E(e,"height",n),u&&u.p&&(!l||p&4096)&&Nt(u,s,c,c[12],l?Dt(s,c[12],p,null):Tt(c[12]),null)},i(c){l||(it(u,c),l=!0)},o(c){st(u,c),l=!1},d(c){c&&P(e),t[14](null),c&&P(a),c&&P(i),u&&u.d(c),t[15](null),h=!1,d()}}}const Mt={};function Jt(t,e,r){let{$$slots:o={},$$scope:n}=e,{width:a=640,height:i=640,pixelRatio:l=void 0,style:h=null,autoclear:d=!0}=e,s,u,c,p,x;const g=Ht(),y=new Ut;function m(){y.redraw()}function _(){return s}function b(){return u}l===void 0&&(typeof window=="undefined"?l=2:l=window.devicePixelRatio);function w(){y.render({context:u,width:a,height:i,pixelRatio:l,autoclear:d}),c=window.requestAnimationFrame(w)}At(Mt,{register:y.register,unregister:y.unregister,redraw:y.redraw}),gt(()=>{u=s.getContext("2d"),x=new MutationObserver(M),x.observe(p,{childList:!0}),M(),w();function M(){const T=[...p.children].map(K=>+K.dataset.layerId);r(11,y.layerSequence=T,y),y.redraw()}}),mt(()=>{typeof window!="undefined"&&(window.cancelAnimationFrame(c),x.disconnect())});function f(M){$[M?"unshift":"push"](()=>{s=M,r(4,s)})}function v(M){$[M?"unshift":"push"](()=>{p=M,r(5,p)})}return t.$$set=M=>{"width"in M&&r(1,a=M.width),"height"in M&&r(2,i=M.height),"pixelRatio"in M&&r(0,l=M.pixelRatio),"style"in M&&r(3,h=M.style),"autoclear"in M&&r(7,d=M.autoclear),"$$scope"in M&&r(12,n=M.$$scope)},t.$$.update=()=>{t.$$.dirty&2183&&y.resize()},[l,a,i,h,s,p,g,d,m,_,b,y,n,o,f,v]}class Qt extends et{constructor(e){super(),rt(this,e,Jt,Gt,ot,{width:1,height:2,pixelRatio:0,style:3,autoclear:7,redraw:8,getCanvas:9,getContext:10})}get redraw(){return this.$$.ctx[8]}get getCanvas(){return this.$$.ctx[9]}get getContext(){return this.$$.ctx[10]}}function St(t){let e;return{c(){e=R("div"),this.h()},l(r){e=q(r,"DIV",{"data-layer-id":!0}),L(e).forEach(P),this.h()},h(){E(e,"data-layer-id",t[0])},m(r,o){F(r,e,o)},p:z,i:z,o:z,d(r){r&&P(e)}}}function Xt(t,e,r){const{register:o,unregister:n,redraw:a}=Ft(Mt);let{setup:i=void 0,render:l=()=>{}}=e;if(typeof i!="function"&&i!==void 0)throw new Error("setup must be a function");if(typeof l!="function")throw new Error("render must be a function");const h=o({setup:i,render:l});return mt(()=>n(h)),t.$$set=d=>{"setup"in d&&r(1,i=d.setup),"render"in d&&r(2,l=d.render)},t.$$.update=()=>{t.$$.dirty&4&&a()},[h,i,l]}class Yt extends et{constructor(e){super(),rt(this,e,Xt,St,ot,{setup:1,render:2})}}let lt;const kt=Date.now();function Vt(t){return t(Date.now()-kt),lt=window.requestAnimationFrame(()=>Vt(t)),()=>window.cancelAnimationFrame(lt)}function Wt(){}var zt=Kt(Date.now()-kt,typeof window=="undefined"?Wt:Vt),k=k||{};k.Image=function(t,e,r){this.width=t||0,this.height=e||0,this.data=r||[]};k.grayscale=function(t,e){for(var r=t.data,o=e.data,n=r.length,a=0,i=0;a<n;a+=4)o[i++]=r[a]*.299+r[a+1]*.587+r[a+2]*.114+.5&255;return e.width=t.width,e.height=t.height,e};k.threshold=function(t,e,r){var o=t.data,n=e.data,a=o.length,i=[],l;for(l=0;l<256;++l)i[l]=l<=r?0:255;for(l=0;l<a;++l)n[l]=i[o[l]];return e.width=t.width,e.height=t.height,e};k.adaptiveThreshold=function(t,e,r,o){var n=t.data,a=e.data,i=n.length,l=[],h;for(k.stackBoxBlur(t,e,r),h=0;h<768;++h)l[h]=h-255<=-o?255:0;for(h=0;h<i;++h)a[h]=l[n[h]-a[h]+255];return e.width=t.width,e.height=t.height,e};k.otsu=function(t){var e=t.data,r=e.length,o=[],n=0,a=0,i=0,l=0,h=0,d=0,s,u,c;for(c=0;c<256;++c)o[c]=0;for(c=0;c<r;++c)o[e[c]]++;for(c=0;c<256;++c)a+=o[c]*c;for(c=0;c<256;++c)if(l+=o[c],l!==0){if(h=r-l,h===0)break;i+=o[c]*c,s=i/l-(a-i)/h,u=l*h*s*s,u>d&&(d=u,n=c)}return n};k.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265];k.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13];k.BlurStack=function(){this.color=0,this.next=null};k.stackBoxBlur=function(t,e,r){var o=t.data,n=e.data,a=t.height,i=t.width,l=a-1,h=i-1,d=r+r+1,s=r+1,u=k.stackBoxBlurMult[r],c=k.stackBoxBlurShift[r],p,x,g,y,m,_,b,w,f,v;for(p=x=new k.BlurStack,v=1;v<d;++v)p=p.next=new k.BlurStack;for(p.next=x,m=0,f=0;f<a;++f){for(_=m,g=o[m],y=s*g,p=x,v=0;v<s;++v)p.color=g,p=p.next;for(v=1;v<s;++v)p.color=o[m+v],y+=p.color,p=p.next;for(p=x,w=0;w<i;++w)n[m++]=y*u>>>c,b=w+s,b=_+(b<h?b:h),y-=p.color-o[b],p.color=o[b],p=p.next}for(w=0;w<i;++w){for(m=w,_=m+i,g=n[m],y=s*g,p=x,v=0;v<s;++v)p.color=g,p=p.next;for(v=1;v<s;++v)p.color=n[_],y+=p.color,p=p.next,_+=i;for(p=x,f=0;f<a;++f)n[m]=y*u>>>c,b=f+s,b=w+(b<l?b:l)*i,y-=p.color-n[b],p.color=n[b],p=p.next,m+=i}return e};k.gaussianBlur=function(t,e,r,o){var n=k.gaussianKernel(o);return e.width=t.width,e.height=t.height,r.width=t.width,r.height=t.height,k.gaussianBlurFilter(t,r,n,!0),k.gaussianBlurFilter(r,e,n,!1),e};k.gaussianBlurFilter=function(t,e,r,o){var n=t.data,a=e.data,i=t.height,l=t.width,h=0,d=r.length>>1,s,u,c,p,x;for(c=0;c<i;++c)for(p=0;p<l;++p){for(u=0,x=-d;x<=d;++x)o?(s=h+x,(p+x<0||p+x>=l)&&(s=h)):(s=h+x*l,(c+x<0||c+x>=i)&&(s=h)),u+=r[d+x]*n[s];a[h++]=o?u:u+.5&255}return e};k.gaussianKernel=function(t){var e=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],r=[],o,n,a,i,l,h;if(t<=7&&t%2===1)r=e[t>>1];else{for(o=(t-1)*.5,n=.8+.3*(o-1),a=-.5/(n*n),i=0,h=0;h<t;++h)l=h-o,i+=r[h]=Math.exp(a*l*l);for(i=1/i,h=0;h<t;++h)r[h]*=i}return r};k.findContours=function(t,e){var r=t.width,o=t.height,n=[],a,i,l,h,d,s,u,c,p;for(a=k.binaryBorder(t,e),i=k.neighborhoodDeltas(r+2),l=r+3,d=1,c=0;c<o;++c,l+=2)for(p=0;p<r;++p,++l)h=a[l],h!==0&&(s=u=!1,h===1&&a[l-1]===0?s=!0:h>=1&&a[l+1]===0&&(u=!0),(s||u)&&(++d,n.push(k.borderFollowing(a,l,d,{x:p,y:c},u,i))));return n};k.borderFollowing=function(t,e,r,o,n,a){var i=[],l,h,d,s,u;i.hole=n,s=u=n?0:4;do if(s=s-1&7,l=e+a[s],t[l]!==0)break;while(s!==u);if(s===u)t[e]=-r,i.push({x:o.x,y:o.y});else for(h=e;;){u=s;do d=h+a[++s];while(t[d]===0);if(s&=7,s-1>>>0<u>>>0?t[h]=-r:t[h]===1&&(t[h]=r),i.push({x:o.x,y:o.y}),o.x+=k.neighborhood[s][0],o.y+=k.neighborhood[s][1],d===e&&h===l)break;h=d,s=s+4&7}return i};k.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]];k.neighborhoodDeltas=function(t){for(var e=[],r=k.neighborhood.length,o=0;o<r;++o)e[o]=k.neighborhood[o][0]+k.neighborhood[o][1]*t;return e.concat(e)};k.approxPolyDP=function(t,e){var r={start_index:0,end_index:0},o={start_index:0,end_index:0},n=[],a=[],i=t.length,l,h,d,s,u,c,p,x,g,y,m;for(e*=e,m=0,g=0;g<3;++g)for(u=0,m=(m+o.start_index)%i,h=t[m],++m===i&&(m=0),y=1;y<i;++y)l=t[m],++m===i&&(m=0),p=l.x-h.x,x=l.y-h.y,s=p*p+x*x,s>u&&(u=s,o.start_index=y);for(u<=e?n.push({x:h.x,y:h.y}):(r.start_index=m,r.end_index=o.start_index+=r.start_index,o.start_index-=o.start_index>=i?i:0,o.end_index=r.start_index,o.end_index<o.start_index&&(o.end_index+=i),a.push({start_index:o.start_index,end_index:o.end_index}),a.push({start_index:r.start_index,end_index:r.end_index}));a.length!==0;){if(r=a.pop(),d=t[r.end_index%i],h=t[m=r.start_index%i],++m===i&&(m=0),r.end_index<=r.start_index+1)c=!0;else{for(u=0,p=d.x-h.x,x=d.y-h.y,g=r.start_index+1;g<r.end_index;++g)l=t[m],++m===i&&(m=0),s=Math.abs((l.y-h.y)*p-(l.x-h.x)*x),s>u&&(u=s,o.start_index=g);c=u*u<=e*(p*p+x*x)}c?n.push({x:h.x,y:h.y}):(o.end_index=r.end_index,r.end_index=o.start_index,a.push({start_index:o.start_index,end_index:o.end_index}),a.push({start_index:r.start_index,end_index:r.end_index}))}return n};k.warp=function(t,e,r,o){var n=t.data,a=e.data,i=t.width,l=t.height,h=0,d,s,u,c,p,x,g,y,m,_,b,w,f,v,M,T,K,J,Q,O,X,Y,W;for(f=k.getPerspectiveTransform(r,o-1),v=f[8],M=f[2],T=f[5],Y=0;Y<o;++Y)for(v+=f[7],M+=f[1],T+=f[4],K=v,J=M,Q=T,W=0;W<o;++W)K+=f[6],J+=f[0],Q+=f[3],O=J/K,X=Q/K,d=O>>>0,s=d===i-1?d:d+1,u=O-d,c=1-u,p=X>>>0,x=p===l-1?p:p+1,g=X-p,y=1-g,m=_=p*i,b=w=x*i,a[h++]=y*(c*n[m+d]+u*n[_+s])+g*(c*n[b+d]+u*n[w+s])&255;return e.width=o,e.height=o,e};k.getPerspectiveTransform=function(t,e){var r=k.square2quad(t);return r[0]/=e,r[1]/=e,r[3]/=e,r[4]/=e,r[6]/=e,r[7]/=e,r};k.square2quad=function(t){var e=[],r,o,n,a,i,l,h;return r=t[0].x-t[1].x+t[2].x-t[3].x,o=t[0].y-t[1].y+t[2].y-t[3].y,r===0&&o===0?(e[0]=t[1].x-t[0].x,e[1]=t[2].x-t[1].x,e[2]=t[0].x,e[3]=t[1].y-t[0].y,e[4]=t[2].y-t[1].y,e[5]=t[0].y,e[6]=0,e[7]=0,e[8]=1):(n=t[1].x-t[2].x,a=t[3].x-t[2].x,i=t[1].y-t[2].y,l=t[3].y-t[2].y,h=n*l-a*i,e[6]=(r*l-a*o)/h,e[7]=(n*o-r*i)/h,e[8]=1,e[0]=t[1].x-t[0].x+e[6]*t[1].x,e[1]=t[3].x-t[0].x+e[7]*t[3].x,e[2]=t[0].x,e[3]=t[1].y-t[0].y+e[6]*t[1].y,e[4]=t[3].y-t[0].y+e[7]*t[3].y,e[5]=t[0].y),e};k.isContourConvex=function(t){var e=0,r=!0,o=t.length,n=0,a=0,i,l,h,d,s,u,c,p;for(l=t[o-1],i=t[0],s=i.x-l.x,u=i.y-l.y;n<o;++n){if(++a===o&&(a=0),l=i,i=t[a],c=i.x-l.x,p=i.y-l.y,h=c*u,d=p*s,e|=d>h?1:d<h?2:3,e===3){r=!1;break}s=c,u=p}return r};k.perimeter=function(t){for(var e=t.length,r=0,o=e-1,n=0,a,i;r<e;o=r++)a=t[r].x-t[o].x,i=t[r].y-t[o].y,n+=Math.sqrt(a*a+i*i);return n};k.minEdgeLength=function(t){for(var e=t.length,r=0,o=e-1,n=1/0,a,i,l;r<e;o=r++)i=t[r].x-t[o].x,l=t[r].y-t[o].y,a=i*i+l*l,a<n&&(n=a);return Math.sqrt(n)};k.countNonZero=function(t,e){var r=t.data,o=e.height,n=e.width,a=e.x+e.y*t.width,i=t.width-n,l=0,h,d;for(h=0;h<o;++h){for(d=0;d<n;++d)r[a++]!==0&&++l;a+=i}return l};k.binaryBorder=function(t,e){var r=t.data,o=t.height,n=t.width,a=0,i=0,l,h;for(h=-2;h<n;++h)e[i++]=0;for(l=0;l<o;++l){for(e[i++]=0,h=0;h<n;++h)e[i++]=r[a++]===0?0:1;e[i++]=0}for(h=-2;h<n;++h)e[i++]=0;return e};var Pt=k,B=Pt,N=N||{};N.Marker=function(t,e){this.id=t,this.corners=e};N.Detector=function(){this.grey=new B.Image,this.thres=new B.Image,this.homography=new B.Image,this.binary=[],this.contours=[],this.polys=[],this.candidates=[]};N.Detector.prototype.detect=function(t){return B.grayscale(t,this.grey),B.adaptiveThreshold(this.grey,this.thres,2,7),this.contours=B.findContours(this.thres,this.binary),this.candidates=this.findCandidates(this.contours,t.width*.2,.05,10),this.candidates=this.clockwiseCorners(this.candidates),this.candidates=this.notTooNear(this.candidates,10),this.findMarkers(this.grey,this.candidates,49)};N.Detector.prototype.findCandidates=function(t,e,r,o){var n=[],a=t.length,i,l,h;for(this.polys=[],h=0;h<a;++h)i=t[h],i.length>=e&&(l=B.approxPolyDP(i,i.length*r),this.polys.push(l),l.length===4&&B.isContourConvex(l)&&B.minEdgeLength(l)>=o&&n.push(l));return n};N.Detector.prototype.clockwiseCorners=function(t){var e=t.length,r,o,n,a,i,l;for(l=0;l<e;++l)r=t[l][1].x-t[l][0].x,n=t[l][1].y-t[l][0].y,o=t[l][2].x-t[l][0].x,a=t[l][2].y-t[l][0].y,r*a-n*o<0&&(i=t[l][1],t[l][1]=t[l][3],t[l][3]=i);return t};N.Detector.prototype.notTooNear=function(t,e){var r=[],o=t.length,n,a,i,l,h,d;for(l=0;l<o;++l)for(h=l+1;h<o;++h){for(n=0,d=0;d<4;++d)a=t[l][d].x-t[h][d].x,i=t[l][d].y-t[h][d].y,n+=a*a+i*i;n/4<e*e&&(B.perimeter(t[l])<B.perimeter(t[h])?t[l].tooNear=!0:t[h].tooNear=!0)}for(l=0;l<o;++l)t[l].tooNear||r.push(t[l]);return r};N.Detector.prototype.findMarkers=function(t,e,r){var o=[],n=e.length,a,i,l;for(l=0;l<n;++l)a=e[l],B.warp(t,this.homography,a,r),B.threshold(this.homography,this.homography,B.otsu(this.homography)),i=this.getMarker(this.homography,a),i&&o.push(i);return o};N.Detector.prototype.getMarker=function(t,e){var r=t.width/7>>>0,o=r*r>>1,n=[],a=[],i=[],l,h,d,s,u;for(s=0;s<7;++s)for(d=s===0||s===6?1:6,u=0;u<7;u+=d)if(l={x:u*r,y:s*r,width:r,height:r},B.countNonZero(t,l)>o)return null;for(s=0;s<5;++s)for(n[s]=[],u=0;u<5;++u)l={x:(u+1)*r,y:(s+1)*r,width:r,height:r},n[s][u]=B.countNonZero(t,l)>o?1:0;for(a[0]=n,i[0]=this.hammingDistance(a[0]),h={first:i[0],second:0},s=1;s<4;++s)a[s]=this.rotate(a[s-1]),i[s]=this.hammingDistance(a[s]),i[s]<h.first&&(h.first=i[s],h.second=s);return h.first!==0?null:new N.Marker(this.mat2id(a[h.second]),this.rotate2(e,4-h.second))};N.Detector.prototype.hammingDistance=function(t){var e=[[1,0,0,0,0],[1,0,1,1,1],[0,1,0,0,1],[0,1,1,1,0]],r=0,o,n,a,i,l;for(a=0;a<5;++a){for(n=1/0,i=0;i<4;++i){for(o=0,l=0;l<5;++l)o+=t[a][l]===e[i][l]?0:1;o<n&&(n=o)}r+=n}return r};N.Detector.prototype.mat2id=function(t){var e=0,r;for(r=0;r<5;++r)e<<=1,e|=t[r][1],e<<=1,e|=t[r][3];return e};N.Detector.prototype.rotate=function(t){var e=[],r=t.length,o,n;for(o=0;o<r;++o)for(e[o]=[],n=0;n<t[o].length;++n)e[o][n]=t[t[o].length-n-1][o];return e};N.Detector.prototype.rotate2=function(t,e){var r=[],o=t.length,n;for(n=0;n<o;++n)r[n]=t[(e+n)%o];return r};var $t=N,A=A||{};A.svdcmp=function(t,e,r,o,n){var a,i,l,h,d,s,u,c,p=0,x,g,y=0,m,_,b=0,w,f,v,M=[];for(i=0;i<r;++i){if(u=i+1,M[i]=b*y,y=_=b=0,i<e){for(s=i;s<e;++s)b+=Math.abs(t[s][i]);if(b!==0){for(s=i;s<e;++s)t[s][i]/=b,_+=t[s][i]*t[s][i];for(g=t[i][i],y=-A.sign(Math.sqrt(_),g),m=g*y-_,t[i][i]=g-y,h=u;h<r;++h){for(_=0,s=i;s<e;++s)_+=t[s][i]*t[s][h];for(g=_/m,s=i;s<e;++s)t[s][h]+=g*t[s][i]}for(s=i;s<e;++s)t[s][i]*=b}}if(o[i]=b*y,y=_=b=0,i<e&&i!==r-1){for(s=u;s<r;++s)b+=Math.abs(t[i][s]);if(b!==0){for(s=u;s<r;++s)t[i][s]/=b,_+=t[i][s]*t[i][s];for(g=t[i][u],y=-A.sign(Math.sqrt(_),g),m=g*y-_,t[i][u]=g-y,s=u;s<r;++s)M[s]=t[i][s]/m;for(h=u;h<e;++h){for(_=0,s=u;s<r;++s)_+=t[h][s]*t[i][s];for(s=u;s<r;++s)t[h][s]+=_*M[s]}for(s=u;s<r;++s)t[i][s]*=b}}p=Math.max(p,Math.abs(o[i])+Math.abs(M[i]))}for(i=r-1;i>=0;--i){if(i<r-1){if(y!==0){for(h=u;h<r;++h)n[h][i]=t[i][h]/t[i][u]/y;for(h=u;h<r;++h){for(_=0,s=u;s<r;++s)_+=t[i][s]*n[s][h];for(s=u;s<r;++s)n[s][h]+=_*n[s][i]}}for(h=u;h<r;++h)n[i][h]=n[h][i]=0}n[i][i]=1,y=M[i],u=i}for(i=Math.min(r,e)-1;i>=0;--i){for(u=i+1,y=o[i],h=u;h<r;++h)t[i][h]=0;if(y!==0){for(y=1/y,h=u;h<r;++h){for(_=0,s=u;s<e;++s)_+=t[s][i]*t[s][h];for(g=_/t[i][i]*y,s=i;s<e;++s)t[s][h]+=g*t[s][i]}for(h=i;h<e;++h)t[h][i]*=y}else for(h=i;h<e;++h)t[h][i]=0;++t[i][i]}for(s=r-1;s>=0;--s)for(l=1;l<=30;++l){for(a=!0,u=s;u>=0;--u){if(c=u-1,Math.abs(M[u])+p===p){a=!1;break}if(Math.abs(o[c])+p===p)break}if(a)for(x=0,_=1,i=u;i<=s&&(g=_*M[i],Math.abs(g)+p!==p);++i)for(y=o[i],m=A.pythag(g,y),o[i]=m,m=1/m,x=y*m,_=-g*m,h=1;h<=e;++h)f=t[h][c],v=t[h][i],t[h][c]=f*x+v*_,t[h][i]=v*x-f*_;if(v=o[s],u===s){if(v<0)for(o[s]=-v,h=0;h<r;++h)n[h][s]=-n[h][s];break}if(l===30)return!1;for(w=o[u],c=s-1,f=o[c],y=M[c],m=M[s],g=((f-v)*(f+v)+(y-m)*(y+m))/(2*m*f),y=A.pythag(g,1),g=((w-v)*(w+v)+m*(f/(g+A.sign(y,g))-m))/w,x=_=1,h=u;h<=c;++h){for(i=h+1,y=M[i],f=o[i],m=_*y,y=x*y,v=A.pythag(g,m),M[h]=v,x=g/v,_=m/v,g=w*x+y*_,y=y*x-w*_,m=f*_,f*=x,d=0;d<r;++d)w=n[d][h],v=n[d][i],n[d][h]=w*x+v*_,n[d][i]=v*x-w*_;for(v=A.pythag(g,m),o[h]=v,v!==0&&(v=1/v,x=g*v,_=m*v),g=x*y+_*f,w=x*f-_*y,d=0;d<e;++d)f=t[d][h],v=t[d][i],t[d][h]=f*x+v*_,t[d][i]=v*x-f*_}M[u]=0,M[s]=g,o[s]=w}return!0};A.pythag=function(t,e){var r=Math.abs(t),o=Math.abs(e),n;return r>o?(n=o/r,r*Math.sqrt(1+n*n)):o===0?0:(n=r/o,o*Math.sqrt(1+n*n))};A.sign=function(t,e){return e>=0?Math.abs(t):-Math.abs(t)};var ht=A,te=ht,C=C||{};C.Posit=function(t,e){this.objectPoints=this.buildModel(t),this.focalLength=e,this.objectVectors=[],this.objectNormal=[],this.objectMatrix=[[],[],[]],this.init()};C.Posit.prototype.buildModel=function(t){var e=t/2;return[[-e,e,0],[e,e,0],[e,-e,0],[-e,-e,0]]};C.Posit.prototype.init=function(){var t=this.objectPoints.length,e=[],r=[],o=0,n=2,a;for(a=0;a<t;++a)this.objectVectors[a]=[this.objectPoints[a][0]-this.objectPoints[0][0],this.objectPoints[a][1]-this.objectPoints[0][1],this.objectPoints[a][2]-this.objectPoints[0][2]],e[a]=[this.objectVectors[a][0],this.objectVectors[a][1],this.objectVectors[a][2]];for(;o===0;)r[0]=this.objectVectors[1][1]*this.objectVectors[n][2]-this.objectVectors[1][2]*this.objectVectors[n][1],r[1]=this.objectVectors[1][2]*this.objectVectors[n][0]-this.objectVectors[1][0]*this.objectVectors[n][2],r[2]=this.objectVectors[1][0]*this.objectVectors[n][1]-this.objectVectors[1][1]*this.objectVectors[n][0],o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),++n;for(a=0;a<3;++a)this.objectNormal[a]=r[a]/o;C.pseudoInverse(e,t,this.objectMatrix)};C.Posit.prototype.pose=function(t){var e=[[],[],[]],r=[[],[],[]],o=[],n=[[],[],[]],a=[[],[],[]],i=[],l=[],h,d,s,u,c,p;for(this.pos(t,e,r,o),s=this.isValid(e,o),s?h=this.iterate(t,e,o,n,i):h={euclidean:-1,pixels:-1,maximum:-1},u=this.isValid(r,o),u?d=this.iterate(t,r,o,a,l):d={euclidean:-1,pixels:-1,maximum:-1},c=0;c<3;++c)for(p=0;p<3;++p)s&&(i[c]-=n[c][p]*this.objectPoints[0][p]),u&&(l[c]-=a[c][p]*this.objectPoints[0][p]);return h.euclidean<d.euclidean?new C.Pose(h.pixels,n,i,d.pixels,a,l):new C.Pose(d.pixels,a,l,h.pixels,n,i)};C.Posit.prototype.pos=function(t,e,r,o){var n=this.objectPoints.length,a=[],i=[],l=[],h=[],d=[],s=[],u=[],c=[],p,x,g,y,m,_,b,w,f,v;for(f=0;f<n;++f)a[f]=[t[f].x-t[0].x,t[f].y-t[0].y];for(f=0;f<3;++f)for(i[f]=0,l[f]=0,v=0;v<n;++v)i[f]+=this.objectMatrix[f][v]*a[v][0],l[f]+=this.objectMatrix[f][v]*a[v][1];for(p=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],x=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],g=i[0]*l[0]+i[1]*l[1]+i[2]*l[2],y=(x-p)*(x-p)+4*(g*g),x-p>=0?m=(x-p+Math.sqrt(y))/2:m=(x-p-Math.sqrt(y))/2,m>=0?(_=Math.sqrt(m),_===0?b=0:b=-g/_):(_=Math.sqrt(-(g*g)/m),_===0?b=Math.sqrt(p-x):b=-g/_),f=0;f<3;++f)h[f]=i[f]+_*this.objectNormal[f],d[f]=l[f]+b*this.objectNormal[f];for(w=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]),f=0;f<3;++f)s[f]=h[f]/w,u[f]=d[f]/w;for(c[0]=s[1]*u[2]-s[2]*u[1],c[1]=s[2]*u[0]-s[0]*u[2],c[2]=s[0]*u[1]-s[1]*u[0],f=0;f<3;++f)e[0][f]=s[f],e[1][f]=u[f],e[2][f]=c[f];for(f=0;f<3;++f)h[f]=i[f]-_*this.objectNormal[f],d[f]=l[f]-b*this.objectNormal[f];for(f=0;f<3;++f)s[f]=h[f]/w,u[f]=d[f]/w;for(c[0]=s[1]*u[2]-s[2]*u[1],c[1]=s[2]*u[0]-s[0]*u[2],c[2]=s[0]*u[1]-s[1]*u[0],f=0;f<3;++f)r[0][f]=s[f],r[1][f]=u[f],r[2][f]=c[f];o[0]=t[0].x/w,o[1]=t[0].y/w,o[2]=this.focalLength/w};C.Posit.prototype.isValid=function(t,e){for(var r=this.objectPoints.length,o=1/0,n=0,a;n<r;++n)a=e[2]+(t[2][0]*this.objectVectors[n][0]+t[2][1]*this.objectVectors[n][1]+t[2][2]*this.objectVectors[n][2]),a<o&&(o=a);return o>=0};C.Posit.prototype.iterate=function(t,e,r,o,n){var a=this.objectPoints.length,i=[],l=[],h=[[],[],[]],d=[[],[],[]],s=[],u=[],c=!1,p=0,x,g,y,m,_,b,w,f,v;for(f=0;f<a;++f)i[f]={x:t[f].x,y:t[f].y};for(f=0;f<3;++f){for(v=0;v<3;++v)o[f][v]=e[f][v];n[f]=r[f]}for(f=0;f<a;++f){for(y=0,v=0;v<3;++v)y+=this.objectVectors[f][v]*o[2][v]/n[2];l[f]={x:(1+y)*t[f].x,y:(1+y)*t[f].y}}for(g=0,f=0;f<a;++f)g+=Math.abs(l[f].x-i[f].x),g+=Math.abs(l[f].y-i[f].y);for(f=0;f<3;++f)s[f]=n[f]-(o[f][0]*this.objectPoints[0][0]+o[f][1]*this.objectPoints[0][1]+o[f][2]*this.objectPoints[0][2]);for(m=_=this.error(t,o,s),c=_.pixels===0||g<.01;p++<100&&!c;){for(f=0;f<a;++f)i[f].x=l[f].x,i[f].y=l[f].y;for(this.pos(l,h,d,n),f=0;f<3;++f)s[f]=n[f]-(h[f][0]*this.objectPoints[0][0]+h[f][1]*this.objectPoints[0][1]+h[f][2]*this.objectPoints[0][2]),u[f]=n[f]-(d[f][0]*this.objectPoints[0][0]+d[f][1]*this.objectPoints[0][1]+d[f][2]*this.objectPoints[0][2]);if(_=this.error(t,h,s),b=this.error(t,d,u),_.euclidean>=0&&b.euclidean>=0)if(b.euclidean<_.euclidean)for(m=b,f=0;f<3;++f)for(v=0;v<3;++v)o[f][v]=d[f][v];else for(m=_,f=0;f<3;++f)for(v=0;v<3;++v)o[f][v]=h[f][v];if(_.euclidean<0&&b.euclidean>=0)for(m=b,f=0;f<3;++f)for(v=0;v<3;++v)o[f][v]=d[f][v];if(b.euclidean<0&&_.euclidean>=0)for(m=_,f=0;f<3;++f)for(v=0;v<3;++v)o[f][v]=h[f][v];for(f=0;f<a;++f){for(y=0,v=0;v<3;++v)y+=this.objectVectors[f][v]*o[2][v]/n[2];l[f].x=(1+y)*t[f].x,l[f].y=(1+y)*t[f].y}for(x=g,g=0,f=0;f<a;++f)g+=Math.abs(l[f].x-i[f].x),g+=Math.abs(l[f].y-i[f].y);w=Math.abs(g-x),c=m.pixels===0||w<.01}return m};C.Posit.prototype.error=function(t,e,r){var o=this.objectPoints.length,n=[],a=[],i=[],l=0,h=0,d=0,s,u,c;if(!this.isValid(e,r))return{euclidean:-1,pixels:-1,maximum:-1};for(s=0;s<o;++s)for(n[s]=[],u=0;u<3;++u)n[s][u]=r[u];for(s=0;s<o;++s)for(u=0;u<3;++u)for(c=0;c<3;++c)n[s][u]+=e[u][c]*this.objectPoints[s][c];for(s=0;s<o;++s)for(a[s]=[],u=0;u<2;++u)a[s][u]=this.focalLength*n[s][u]/n[s][2];for(s=0;s<o;++s)i[s]=[a[s][0]-t[s].x,a[s][1]-t[s].y];for(s=0;s<o;++s)l+=Math.sqrt(i[s][0]*i[s][0]+i[s][1]*i[s][1]),h+=Math.abs(Math.round(a[s][0])-Math.round(t[s].x))+Math.abs(Math.round(a[s][1])-Math.round(t[s].y)),Math.abs(i[s][0])>d&&(d=Math.abs(i[s][0])),Math.abs(i[s][1])>d&&(d=Math.abs(i[s][1]));return{euclidean:l/o,pixels:h,maximum:d}};C.pseudoInverse=function(t,e,r){var o=[],n=[[],[],[]],a=[[],[],[]],i=0,l=0,h,d,s;for(te.svdcmp(t,e,3,o,n),h=0;h<3;++h)o[h]>i&&(i=o[h]);for(i*=.01,h=0;h<3;++h)o[h]<i&&(o[h]=0);for(d=0;d<3;++d)if(o[d]===0)for(++l,s=d;s<2;++s){for(h=0;h<e;++h)t[h][s]=t[h][s+1];for(h=0;h<3;++h)n[h][s]=n[h][s+1]}for(d=0;d<2;++d)o[d]===0&&(o[d]=o[d+1]);for(h=0;h<3;++h)for(d=0;d<3-l;++d)a[h][d]=n[h][d]/o[d];for(h=0;h<3;++h)for(d=0;d<e;++d)for(r[h][d]=0,s=0;s<3-l;++s)r[h][d]+=a[h][s]*t[d][s]};C.Pose=function(t,e,r,o,n,a){this.bestError=t,this.bestRotation=e,this.bestTranslation=r,this.alternativeError=o,this.alternativeRotation=n,this.alternativeTranslation=a};var ee=C,re=ht,D=D||{};D.Posit=function(t,e){this.model=this.buildModel(t),this.focalLength=e,this.init()};D.Posit.prototype.buildModel=function(t){var e=t/2;return[new j(-e,e,0),new j(e,e,0),new j(e,-e,0),new j(-e,-e,0)]};D.Posit.prototype.init=function(){var t=new j,e=new V,r;this.modelVectors=V.fromRows(j.sub(this.model[1],this.model[0]),j.sub(this.model[2],this.model[0]),j.sub(this.model[3],this.model[0])),r=V.clone(this.modelVectors),re.svdcmp(r.m,3,3,t.v,e.m),this.modelPseudoInverse=V.mult(V.mult(e,V.fromDiagonal(j.inverse(t))),V.transpose(r)),this.modelNormal=e.column(t.minIndex())};D.Posit.prototype.pose=function(t){var e=new j(1,1,1),r=new V,o=new V,n=new j,a=new j,i,l;return this.pos(t,e,r,o,n,a),i=this.iterate(t,r,n),l=this.iterate(t,o,a),i<l?new D.Pose(i,r.m,n.v,l,o.m,a.v):new D.Pose(l,o.m,a.v,i,r.m,n.v)};D.Posit.prototype.pos=function(t,e,r,o,n,a){var i=new j(t[1].x,t[2].x,t[3].x),l=new j(t[1].y,t[2].y,t[3].y),h=j.addScalar(j.mult(i,e),-t[0].x),d=j.addScalar(j.mult(l,e),-t[0].y),s=V.multVector(this.modelPseudoInverse,h),u=V.multVector(this.modelPseudoInverse,d),c=u.square()-s.square(),p=j.dot(s,u),x=0,g=0,y,m,_,b,w,f,v,M,T;c===0?(x=Math.sqrt(Math.abs(2*p)),g=-Math.PI/2*(p<0?-1:p>0?1:0)):(x=Math.sqrt(Math.sqrt(c*c+4*p*p)),g=Math.atan(-2*p/c),c<0&&(g+=Math.PI),g/=2),M=x*Math.cos(g),T=x*Math.sin(g),y=j.add(s,j.multScalar(this.modelNormal,M)),m=j.add(u,j.multScalar(this.modelNormal,T)),b=y.normalize(),w=m.normalize(),_=j.cross(y,m),r.copy(V.fromRows(y,m,_)),f=(b+w)/2,v=V.multVector(r,this.model[0]),n.v=[t[0].x/f-v.v[0],t[0].y/f-v.v[1],this.focalLength/f],y=j.sub(s,j.multScalar(this.modelNormal,M)),m=j.sub(u,j.multScalar(this.modelNormal,T)),b=y.normalize(),w=m.normalize(),_=j.cross(y,m),o.copy(V.fromRows(y,m,_)),f=(b+w)/2,v=V.multVector(o,this.model[0]),a.v=[t[0].x/f-v.v[0],t[0].y/f-v.v[1],this.focalLength/f]};D.Posit.prototype.iterate=function(t,e,r){for(var o=1/0,n=new V,a=new V,i=new j,l=new j,h=0,d,s,u,c;h<100&&(d=j.addScalar(j.multScalar(V.multVector(this.modelVectors,e.row(2)),1/r.v[2]),1),this.pos(t,d,n,a,i,l),u=this.getError(t,n,i),c=this.getError(t,a,l),u<c?(e.copy(n),r.copy(i),s=u):(e.copy(a),r.copy(l),s=c),!(s<=2||s>o));++h)o=s;return s};D.Posit.prototype.getError=function(t,e,r){var o=j.add(V.multVector(e,this.model[0]),r),n=j.add(V.multVector(e,this.model[1]),r),a=j.add(V.multVector(e,this.model[2]),r),i=j.add(V.multVector(e,this.model[3]),r),l,h,d,s,u,c,p,x,g;return o=o.v,n=n.v,a=a.v,i=i.v,o[0]*=this.focalLength/o[2],o[1]*=this.focalLength/o[2],n[0]*=this.focalLength/n[2],n[1]*=this.focalLength/n[2],a[0]*=this.focalLength/a[2],a[1]*=this.focalLength/a[2],i[0]*=this.focalLength/i[2],i[1]*=this.focalLength/i[2],l=[{x:o[0],y:o[1]},{x:n[0],y:n[1]},{x:a[0],y:a[1]},{x:i[0],y:i[1]}],h=this.angle(t[0],t[1],t[3]),d=this.angle(t[1],t[2],t[0]),s=this.angle(t[2],t[3],t[1]),u=this.angle(t[3],t[0],t[2]),c=this.angle(l[0],l[1],l[3]),p=this.angle(l[1],l[2],l[0]),x=this.angle(l[2],l[3],l[1]),g=this.angle(l[3],l[0],l[2]),(Math.abs(h-c)+Math.abs(d-p)+Math.abs(s-x)+Math.abs(u-g))/4};D.Posit.prototype.angle=function(t,e,r){var o=e.x-t.x,n=e.y-t.y,a=r.x-t.x,i=r.y-t.y;return Math.acos((o*a+n*i)/(Math.sqrt(o*o+n*n)*Math.sqrt(a*a+i*i)))*180/Math.PI};D.Pose=function(t,e,r,o,n,a){this.bestError=t,this.bestRotation=e,this.bestTranslation=r,this.alternativeError=o,this.alternativeRotation=n,this.alternativeTranslation=a};var j=function(t,e,r){this.v=[t||0,e||0,r||0]};j.prototype.copy=function(t){var e=this.v;return t=t.v,e[0]=t[0],e[1]=t[1],e[2]=t[2],this};j.add=function(t,e){var r=new j,o=r.v;return t=t.v,e=e.v,o[0]=t[0]+e[0],o[1]=t[1]+e[1],o[2]=t[2]+e[2],r};j.sub=function(t,e){var r=new j,o=r.v;return t=t.v,e=e.v,o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],r};j.mult=function(t,e){var r=new j,o=r.v;return t=t.v,e=e.v,o[0]=t[0]*e[0],o[1]=t[1]*e[1],o[2]=t[2]*e[2],r};j.addScalar=function(t,e){var r=new j,o=r.v;return t=t.v,o[0]=t[0]+e,o[1]=t[1]+e,o[2]=t[2]+e,r};j.multScalar=function(t,e){var r=new j,o=r.v;return t=t.v,o[0]=t[0]*e,o[1]=t[1]*e,o[2]=t[2]*e,r};j.dot=function(t,e){return t=t.v,e=e.v,t[0]*e[0]+t[1]*e[1]+t[2]*e[2]};j.cross=function(t,e){return t=t.v,e=e.v,new j(t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0])};j.prototype.normalize=function(){var t=this.v,e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return e>0&&(t[0]/=e,t[1]/=e,t[2]/=e),e};j.inverse=function(t){var e=new j,r=e.v;return t=t.v,t[0]!==0&&(r[0]=1/t[0]),t[1]!==0&&(r[1]=1/t[1]),t[2]!==0&&(r[2]=1/t[2]),e};j.prototype.square=function(){var t=this.v;return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]};j.prototype.minIndex=function(){var t=this.v;return t[0]<t[1]?t[0]<t[2]?0:2:t[1]<t[2]?1:2};var V=function(){this.m=[[0,0,0],[0,0,0],[0,0,0]]};V.clone=function(t){var e=new V,r=e.m;return t=t.m,r[0][0]=t[0][0],r[0][1]=t[0][1],r[0][2]=t[0][2],r[1][0]=t[1][0],r[1][1]=t[1][1],r[1][2]=t[1][2],r[2][0]=t[2][0],r[2][1]=t[2][1],r[2][2]=t[2][2],e};V.prototype.copy=function(t){var e=this.m;return t=t.m,e[0][0]=t[0][0],e[0][1]=t[0][1],e[0][2]=t[0][2],e[1][0]=t[1][0],e[1][1]=t[1][1],e[1][2]=t[1][2],e[2][0]=t[2][0],e[2][1]=t[2][1],e[2][2]=t[2][2],this};V.fromRows=function(t,e,r){var o=new V,n=o.m;return t=t.v,e=e.v,r=r.v,n[0][0]=t[0],n[0][1]=t[1],n[0][2]=t[2],n[1][0]=e[0],n[1][1]=e[1],n[1][2]=e[2],n[2][0]=r[0],n[2][1]=r[1],n[2][2]=r[2],o};V.fromDiagonal=function(t){var e=new V,r=e.m;return t=t.v,r[0][0]=t[0],r[1][1]=t[1],r[2][2]=t[2],e};V.transpose=function(t){var e=new V,r=e.m;return t=t.m,r[0][0]=t[0][0],r[0][1]=t[1][0],r[0][2]=t[2][0],r[1][0]=t[0][1],r[1][1]=t[1][1],r[1][2]=t[2][1],r[2][0]=t[0][2],r[2][1]=t[1][2],r[2][2]=t[2][2],e};V.mult=function(t,e){var r=new V,o=r.m;return t=t.m,e=e.m,o[0][0]=t[0][0]*e[0][0]+t[0][1]*e[1][0]+t[0][2]*e[2][0],o[0][1]=t[0][0]*e[0][1]+t[0][1]*e[1][1]+t[0][2]*e[2][1],o[0][2]=t[0][0]*e[0][2]+t[0][1]*e[1][2]+t[0][2]*e[2][2],o[1][0]=t[1][0]*e[0][0]+t[1][1]*e[1][0]+t[1][2]*e[2][0],o[1][1]=t[1][0]*e[0][1]+t[1][1]*e[1][1]+t[1][2]*e[2][1],o[1][2]=t[1][0]*e[0][2]+t[1][1]*e[1][2]+t[1][2]*e[2][2],o[2][0]=t[2][0]*e[0][0]+t[2][1]*e[1][0]+t[2][2]*e[2][0],o[2][1]=t[2][0]*e[0][1]+t[2][1]*e[1][1]+t[2][2]*e[2][1],o[2][2]=t[2][0]*e[0][2]+t[2][1]*e[1][2]+t[2][2]*e[2][2],r};V.multVector=function(t,e){return t=t.m,e=e.v,new j(t[0][0]*e[0]+t[0][1]*e[1]+t[0][2]*e[2],t[1][0]*e[0]+t[1][1]*e[1]+t[1][2]*e[2],t[2][0]*e[0]+t[2][1]*e[1]+t[2][2]*e[2])};V.prototype.column=function(t){var e=this.m;return new j(e[0][t],e[1][t],e[2][t])};V.prototype.row=function(t){var e=this.m;return new j(e[t][0],e[t][1],e[t][2])};var oe=D,ie={CV:Pt,AR:$t,SVD:ht,POS1:ee,POS2:oe};function at(t,e,r){const o=t.slice();return o[9]=e[r],o}function ft(t,e,r){const o=t.slice();return o[12]=e[r],o}function ut(t,e,r){const o=t.slice();return o[15]=e[r],o}function ct(t,e,r){const o=t.slice();return o[18]=e[r],o}function se(t){let e,r;return e=new Yt({props:{render:t[2]}}),{c(){_t(e.$$.fragment)},l(o){wt(e.$$.fragment,o)},m(o,n){bt(e,o,n),r=!0},p(o,n){const a={};n&4&&(a.render=o[2]),e.$set(a)},i(o){r||(it(e.$$.fragment,o),r=!0)},o(o){st(e.$$.fragment,o),r=!1},d(o){jt(e,o)}}}function dt(t){let e,r=t[1],o=[];for(let n=0;n<r.length;n+=1)o[n]=xt(at(t,r,n));return{c(){e=R("ul");for(let n=0;n<o.length;n+=1)o[n].c();this.h()},l(n){e=q(n,"UL",{class:!0});var a=L(e);for(let i=0;i<o.length;i+=1)o[i].l(a);a.forEach(P),this.h()},h(){E(e,"class","svelte-h1djsg")},m(n,a){F(n,e,a);for(let i=0;i<o.length;i+=1)o[i].m(e,null)},p(n,a){if(a&2){r=n[1];let i;for(i=0;i<r.length;i+=1){const l=at(n,r,i);o[i]?o[i].p(l,a):(o[i]=xt(l),o[i].c(),o[i].m(e,null))}for(;i<o.length;i+=1)o[i].d(1);o.length=r.length}},d(n){n&&P(e),S(o,n)}}}function vt(t){let e,r=t[18].toFixed(3)+"",o;return{c(){e=R("td"),o=U(r),this.h()},l(n){e=q(n,"TD",{class:!0});var a=L(e);o=G(a,r),a.forEach(P),this.h()},h(){E(e,"class","svelte-h1djsg")},m(n,a){F(n,e,a),I(e,o)},p(n,a){a&2&&r!==(r=n[18].toFixed(3)+"")&&nt(o,r)},d(n){n&&P(e)}}}function pt(t){let e,r=t[15].toFixed(3)+"",o;return{c(){e=R("td"),o=U(r),this.h()},l(n){e=q(n,"TD",{class:!0});var a=L(e);o=G(a,r),a.forEach(P),this.h()},h(){E(e,"class","svelte-h1djsg")},m(n,a){F(n,e,a),I(e,o)},p(n,a){a&2&&r!==(r=n[15].toFixed(3)+"")&&nt(o,r)},d(n){n&&P(e)}}}function yt(t){let e,r,o=t[12],n=[];for(let a=0;a<o.length;a+=1)n[a]=pt(ut(t,o,a));return{c(){e=R("tr");for(let a=0;a<n.length;a+=1)n[a].c();r=Z(),this.h()},l(a){e=q(a,"TR",{class:!0});var i=L(e);for(let l=0;l<n.length;l+=1)n[l].l(i);r=H(i),i.forEach(P),this.h()},h(){E(e,"class","svelte-h1djsg")},m(a,i){F(a,e,i);for(let l=0;l<n.length;l+=1)n[l].m(e,null);I(e,r)},p(a,i){if(i&2){o=a[12];let l;for(l=0;l<o.length;l+=1){const h=ut(a,o,l);n[l]?n[l].p(h,i):(n[l]=pt(h),n[l].c(),n[l].m(e,r))}for(;l<n.length;l+=1)n[l].d(1);n.length=o.length}},d(a){a&&P(e),S(n,a)}}}function xt(t){let e,r,o,n,a=t[9].id+"",i,l,h,d,s,u,c,p,x,g,y=t[9].pose.bestTranslation,m=[];for(let w=0;w<y.length;w+=1)m[w]=vt(ct(t,y,w));let _=t[9].pose.bestRotation,b=[];for(let w=0;w<_.length;w+=1)b[w]=yt(ft(t,_,w));return{c(){e=R("li"),r=R("ul"),o=R("li"),n=U("Marker "),i=U(a),l=Z(),h=R("li"),d=U(`Translation
              `),s=R("table");for(let w=0;w<m.length;w+=1)m[w].c();u=Z(),c=R("li"),p=U(`Rotation
              `),x=R("table");for(let w=0;w<b.length;w+=1)b[w].c();g=Z(),this.h()},l(w){e=q(w,"LI",{class:!0});var f=L(e);r=q(f,"UL",{class:!0});var v=L(r);o=q(v,"LI",{class:!0});var M=L(o);n=G(M,"Marker "),i=G(M,a),M.forEach(P),l=H(v),h=q(v,"LI",{class:!0});var T=L(h);d=G(T,`Translation
              `),s=q(T,"TABLE",{class:!0});var K=L(s);for(let O=0;O<m.length;O+=1)m[O].l(K);K.forEach(P),T.forEach(P),u=H(v),c=q(v,"LI",{class:!0});var J=L(c);p=G(J,`Rotation
              `),x=q(J,"TABLE",{class:!0});var Q=L(x);for(let O=0;O<b.length;O+=1)b[O].l(Q);Q.forEach(P),J.forEach(P),v.forEach(P),g=H(f),f.forEach(P),this.h()},h(){E(o,"class","svelte-h1djsg"),E(s,"class","svelte-h1djsg"),E(h,"class","svelte-h1djsg"),E(x,"class","svelte-h1djsg"),E(c,"class","svelte-h1djsg"),E(r,"class","svelte-h1djsg"),E(e,"class","svelte-h1djsg")},m(w,f){F(w,e,f),I(e,r),I(r,o),I(o,n),I(o,i),I(r,l),I(r,h),I(h,d),I(h,s);for(let v=0;v<m.length;v+=1)m[v].m(s,null);I(r,u),I(r,c),I(c,p),I(c,x);for(let v=0;v<b.length;v+=1)b[v].m(x,null);I(e,g)},p(w,f){if(f&2&&a!==(a=w[9].id+"")&&nt(i,a),f&2){y=w[9].pose.bestTranslation;let v;for(v=0;v<y.length;v+=1){const M=ct(w,y,v);m[v]?m[v].p(M,f):(m[v]=vt(M),m[v].c(),m[v].m(s,null))}for(;v<m.length;v+=1)m[v].d(1);m.length=y.length}if(f&2){_=w[9].pose.bestRotation;let v;for(v=0;v<_.length;v+=1){const M=ft(w,_,v);b[v]?b[v].p(M,f):(b[v]=yt(M),b[v].c(),b[v].m(x,null))}for(;v<b.length;v+=1)b[v].d(1);b.length=_.length}},d(w){w&&P(e),S(m,w),S(b,w)}}}function ne(t){let e,r,o,n,a,i,l,h,d,s,u,c;l=new Qt({props:{width:tt,height:It,$$slots:{default:[se]},$$scope:{ctx:t}}});let p=t[1]!==void 0&&dt(t);return{c(){e=R("video"),r=Z(),o=R("main"),n=R("h1"),a=U("Aruco test"),i=Z(),_t(l.$$.fragment),h=Z(),d=R("h2"),s=U("Markers:"),u=Z(),p&&p.c(),this.h()},l(x){e=q(x,"VIDEO",{class:!0}),L(e).forEach(P),r=H(x),o=q(x,"MAIN",{class:!0});var g=L(o);n=q(g,"H1",{class:!0});var y=L(n);a=G(y,"Aruco test"),y.forEach(P),i=H(g),wt(l.$$.fragment,g),h=H(g),d=q(g,"H2",{class:!0});var m=L(d);s=G(m,"Markers:"),m.forEach(P),u=H(g),p&&p.l(g),g.forEach(P),this.h()},h(){e.autoplay=!0,e.hidden=!0,E(e,"class","svelte-h1djsg"),E(n,"class","svelte-h1djsg"),E(d,"class","svelte-h1djsg"),E(o,"class","svelte-h1djsg")},m(x,g){F(x,e,g),t[4](e),F(x,r,g),F(x,o,g),I(o,n),I(n,a),I(o,i),bt(l,o,null),I(o,h),I(o,d),I(d,s),I(o,u),p&&p.m(o,null),c=!0},p(x,[g]){const y={};g&2097156&&(y.$$scope={dirty:g,ctx:x}),l.$set(y),x[1]!==void 0?p?p.p(x,g):(p=dt(x),p.c(),p.m(o,null)):p&&(p.d(1),p=null)},i(x){c||(it(l.$$.fragment,x),c=!0)},o(x){st(l.$$.fragment,x),c=!1},d(x){x&&P(e),t[4](null),x&&P(r),x&&P(o),jt(l),p&&p.d()}}}const tt=600,It=500;function he(t,e,r){let o,n;Ot(t,zt,c=>r(3,n=c));const{AR:a,POS2:i}=ie;let l;gt(async()=>{r(0,l.srcObject=await navigator.mediaDevices.getUserMedia({video:{width:tt/100,height:It/100}}),l)});const h=new a.Detector,d=new i.Posit(100,tt);let s;function u(c){$[c?"unshift":"push"](()=>{l=c,r(0,l)})}return t.$$.update=()=>{t.$$.dirty&11&&r(2,o=({context:c,width:p,height:x})=>{c.drawImage(l,0,0,p,x);const g=c.getImageData(0,0,p,x);r(1,s=h.detect(g));for(const y of s)y.pose=d.pose(y.corners)})},[l,s,o,n,u]}class fe extends et{constructor(e){super(),rt(this,e,he,ne,ot,{})}}export{fe as default};
